<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Plant Health Analyzer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

```
    body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
        min-height: 100vh;
        padding: 15px;
    }

    .container {
        max-width: 1000px;
        margin: 0 auto;
        background: white;
        border-radius: 20px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        overflow: hidden;
    }

    .header {
        background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
        color: white;
        padding: 30px;
        text-align: center;
    }

    .header h1 {
        font-size: 32px;
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
    }

    .header p {
        opacity: 0.95;
        font-size: 16px;
        margin-top: 8px;
    }

    .content {
        padding: 30px;
    }

    .info-banner {
        background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
        border-left: 4px solid #27ae60;
        padding: 20px;
        border-radius: 10px;
        margin-bottom: 25px;
    }

    .info-banner h3 {
        color: #1b5e20;
        margin-bottom: 8px;
        font-size: 18px;
    }

    .info-banner p {
        color: #2e7d32;
        line-height: 1.6;
        font-size: 14px;
    }

    .upload-section {
        text-align: center;
        padding: 50px 30px;
        border: 3px dashed #27ae60;
        border-radius: 15px;
        background: linear-gradient(135deg, #f1f8e9 0%, #e8f5e9 100%);
        margin-bottom: 25px;
        transition: all 0.3s ease;
    }

    .upload-section:hover {
        border-color: #1b5e20;
        background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
        transform: translateY(-2px);
    }

    .upload-icon {
        font-size: 64px;
        margin-bottom: 20px;
        animation: float 3s ease-in-out infinite;
    }

    @keyframes float {
        0%, 100% { transform: translateY(0px); }
        50% { transform: translateY(-10px); }
    }

    .upload-section h2 {
        color: #1b5e20;
        margin-bottom: 15px;
        font-size: 24px;
    }

    button {
        padding: 18px 40px;
        font-size: 18px;
        font-weight: 600;
        border: none;
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.3s ease;
        background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
        color: white;
        box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3);
    }

    button:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 20px rgba(39, 174, 96, 0.4);
    }

    button:active {
        transform: translateY(-1px);
    }

    .preview-container {
        display: none;
        margin-top: 25px;
    }

    .preview-container.active {
        display: block;
        animation: fadeIn 0.5s ease;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .image-comparison {
        display: flex;
        gap: 20px;
        margin-bottom: 25px;
        flex-wrap: wrap;
    }

    .image-box {
        flex: 1;
        min-width: 250px;
        background: #f8f9fa;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .image-box h3 {
        background: #27ae60;
        color: white;
        padding: 12px;
        text-align: center;
        font-size: 16px;
    }

    .image-box img {
        width: 100%;
        display: block;
    }

    .image-box canvas {
        width: 100%;
        display: block;
    }

    .analyze-button-container {
        text-align: center;
        margin: 25px 0;
    }

    .analyze-btn {
        padding: 20px 50px;
        font-size: 20px;
        background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
        animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {
        0%, 100% { box-shadow: 0 4px 15px rgba(46, 204, 113, 0.3); }
        50% { box-shadow: 0 4px 25px rgba(46, 204, 113, 0.6); }
    }

    .loading {
        text-align: center;
        padding: 50px;
        display: none;
    }

    .loading.active {
        display: block;
    }

    .spinner {
        border: 5px solid #f3f3f3;
        border-top: 5px solid #27ae60;
        border-radius: 50%;
        width: 60px;
        height: 60px;
        animation: spin 1s linear infinite;
        margin: 0 auto 20px;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    .loading p {
        color: #27ae60;
        font-size: 18px;
        font-weight: 600;
    }

    .results {
        margin-top: 30px;
        display: none;
    }

    .results.active {
        display: block;
        animation: slideUp 0.5s ease;
    }

    @keyframes slideUp {
        from { opacity: 0; transform: translateY(30px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .results-header {
        background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
        color: white;
        padding: 20px;
        border-radius: 12px 12px 0 0;
        text-align: center;
    }

    .results-header h2 {
        font-size: 26px;
        margin-bottom: 8px;
    }

    .overall-health {
        padding: 25px;
        background: #f8f9fa;
        border-left: 5px solid #27ae60;
        margin: 20px 0;
        border-radius: 8px;
    }

    .overall-health.healthy {
        background: #e8f5e9;
        border-left-color: #2ecc71;
    }

    .overall-health.warning {
        background: #fff3e0;
        border-left-color: #ff9800;
    }

    .overall-health.critical {
        background: #ffebee;
        border-left-color: #f44336;
    }

    .overall-health h3 {
        font-size: 22px;
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .health-status {
        display: inline-block;
        padding: 6px 16px;
        border-radius: 20px;
        font-size: 14px;
        font-weight: 600;
        margin-left: 10px;
    }

    .health-status.excellent {
        background: #2ecc71;
        color: white;
    }

    .health-status.good {
        background: #3498db;
        color: white;
    }

    .health-status.fair {
        background: #ff9800;
        color: white;
    }

    .health-status.poor {
        background: #f44336;
        color: white;
    }

    .deficiency-card {
        background: white;
        border-left: 5px solid #e74c3c;
        padding: 25px;
        margin: 20px 0;
        border-radius: 10px;
        box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        transition: transform 0.3s ease;
    }

    .deficiency-card:hover {
        transform: translateX(5px);
    }

    .deficiency-card.severe {
        border-left-color: #c0392b;
        background: #ffebee;
    }

    .deficiency-card.moderate {
        border-left-color: #f39c12;
        background: #fff3e0;
    }

    .deficiency-card.mild {
        border-left-color: #3498db;
        background: #e3f2fd;
    }

    .deficiency-card.healthy {
        border-left-color: #2ecc71;
        background: #e8f5e9;
    }

    .deficiency-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
        flex-wrap: wrap;
        gap: 10px;
    }

    .deficiency-name {
        font-size: 24px;
        font-weight: 700;
        color: #2c3e50;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .confidence-badge {
        padding: 8px 16px;
        border-radius: 25px;
        font-size: 13px;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .confidence-badge.high {
        background: #c0392b;
        color: white;
    }

    .confidence-badge.medium {
        background: #f39c12;
        color: white;
    }

    .confidence-badge.low {
        background: #3498db;
        color: white;
    }

    .deficiency-description {
        color: #34495e;
        line-height: 1.8;
        margin-bottom: 20px;
        font-size: 16px;
    }

    .symptoms-section {
        background: rgba(255,255,255,0.6);
        padding: 18px;
        border-radius: 8px;
        margin-bottom: 15px;
    }

    .symptoms-section h4 {
        color: #2c3e50;
        margin-bottom: 12px;
        font-size: 16px;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .symptoms-section ul {
        margin-left: 25px;
        color: #34495e;
    }

    .symptoms-section li {
        margin-bottom: 8px;
        line-height: 1.6;
    }

    .treatment-section {
        background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
        padding: 20px;
        border-radius: 10px;
        border: 2px solid #27ae60;
    }

    .treatment-section h4 {
        color: #1b5e20;
        margin-bottom: 15px;
        font-size: 18px;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .treatment-section ul {
        margin-left: 25px;
        color: #2e7d32;
    }

    .treatment-section li {
        margin-bottom: 10px;
        line-height: 1.7;
        font-weight: 500;
    }

    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin: 20px 0;
    }

    .stat-card {
        background: white;
        padding: 20px;
        border-radius: 10px;
        text-align: center;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .stat-value {
        font-size: 32px;
        font-weight: 700;
        color: #27ae60;
        margin-bottom: 5px;
    }

    .stat-label {
        color: #7f8c8d;
        font-size: 14px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .disclaimer {
        background: #ecf0f1;
        padding: 20px;
        border-radius: 10px;
        margin-top: 30px;
        border-left: 4px solid #95a5a6;
    }

    .disclaimer h4 {
        color: #2c3e50;
        margin-bottom: 10px;
    }

    .disclaimer p {
        color: #7f8c8d;
        line-height: 1.6;
        font-size: 14px;
    }

    @media (max-width: 768px) {
        .header h1 {
            font-size: 24px;
        }
        
        .image-comparison {
            flex-direction: column;
        }
        
        .deficiency-header {
            flex-direction: column;
            align-items: flex-start;
        }
    }
</style>
```

</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üå± Plant Health Analyzer</h1>
            <p>Professional Color-Based Nutrient Deficiency Detection</p>
        </div>

```
    <div class="content">
        <div class="info-banner">
            <h3>üî¨ How It Works</h3>
            <p>This analyzer examines the color patterns in your plant photos to detect common nutrient deficiencies. It looks for yellowing (nitrogen), purple/red tints (phosphorus), brown edges (potassium), and other telltale signs. Upload a clear photo of your plant for best results!</p>
        </div>

        <div class="upload-section" onclick="document.getElementById('fileInput').click()">
            <div class="upload-icon">üì∏</div>
            <h2>Upload Your Plant Photo</h2>
            <button onclick="event.stopPropagation(); document.getElementById('fileInput').click()">
                Choose Photo
            </button>
            <input type="file" id="fileInput" accept="image/*" style="display:none;">
        </div>

        <div class="preview-container" id="previewContainer">
            <div class="image-comparison">
                <div class="image-box">
                    <h3>üì∑ Original Image</h3>
                    <img id="originalImage" alt="Original plant photo">
                </div>
                <div class="image-box">
                    <h3>üé® Color Analysis Visualization</h3>
                    <canvas id="analysisCanvas"></canvas>
                </div>
            </div>

            <div class="analyze-button-container">
                <button class="analyze-btn" onclick="analyzeImage()">
                    üîç Analyze Plant Health
                </button>
            </div>
        </div>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Analyzing your plant...</p>
        </div>

        <div class="results" id="results"></div>
    </div>
</div>

<script>
    let imageData = null;
    let originalImage = null;

    document.getElementById('fileInput').onchange = function(e) {
        const file = e.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function(event) {
            imageData = event.target.result;
            document.getElementById('originalImage').src = imageData;
            document.getElementById('previewContainer').classList.add('active');
            document.getElementById('results').classList.remove('active');
            
            // Load image for canvas
            originalImage = new Image();
            originalImage.src = imageData;
        };
        reader.readAsDataURL(file);
    };

    function analyzeImage() {
        if (!imageData) {
            alert('Please upload an image first!');
            return;
        }

        document.getElementById('loading').classList.add('active');
        document.getElementById('results').classList.remove('active');

        // Small delay for smooth UX
        setTimeout(() => {
            const img = new Image();
            img.onload = function() {
                performAnalysis(img);
            };
            img.src = imageData;
        }, 500);
    }

    function performAnalysis(img) {
        // Create canvas for analysis
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');

        // Resize for performance
        const maxSize = 600;
        let width = img.width;
        let height = img.height;

        if (width > height && width > maxSize) {
            height = (height * maxSize) / width;
            width = maxSize;
        } else if (height > maxSize) {
            width = (width * maxSize) / height;
            height = maxSize;
        }

        canvas.width = width;
        canvas.height = height;
        ctx.drawImage(img, 0, 0, width, height);

        // Get pixel data
        const imageData = ctx.getImageData(0, 0, width, height);
        const pixels = imageData.data;

        // Analyze pixels
        const analysis = analyzePixels(pixels, width, height);

        // Create visualization
        createVisualization(img, analysis);

        // Display results
        document.getElementById('loading').classList.remove('active');
        displayResults(analysis);
    }

    function analyzePixels(pixels, width, height) {
        let totalPixels = 0;
        let yellowPixels = 0;
        let greenPixels = 0;
        let darkGreenPixels = 0;
        let lightGreenPixels = 0;
        let purplePixels = 0;
        let redPixels = 0;
        let brownPixels = 0;
        let palePixels = 0;
        
        let avgBrightness = 0;
        let avgSaturation = 0;

        for (let i = 0; i < pixels.length; i += 4) {
            const r = pixels[i];
            const g = pixels[i + 1];
            const b = pixels[i + 2];

            const brightness = (r + g + b) / 3;
            
            // Skip very dark or very bright pixels (likely shadows/highlights)
            if (brightness < 25 || brightness > 245) continue;

            totalPixels++;
            avgBrightness += brightness;

            const h = rgbToHue(r, g, b);
            const s = rgbToSaturation(r, g, b);
            avgSaturation += s;

            // Yellow (nitrogen deficiency)
            if (h >= 35 && h <= 75 && s > 0.25 && g > r * 0.85) {
                yellowPixels++;
            }

            // Green analysis
            if (h >= 75 && h <= 165 && s > 0.15) {
                greenPixels++;
                if (brightness < 100) {
                    darkGreenPixels++;
                } else if (brightness > 160) {
                    lightGreenPixels++;
                }
            }

            // Purple/Red (phosphorus)
            if ((h < 25 || h > 320) && s > 0.2) {
                if (h > 320 || h < 10) {
                    redPixels++;
                }
                purplePixels++;
            }

            // Brown (potassium)
            if (h >= 10 && h <= 50 && s > 0.15 && s < 0.6 && brightness < 140) {
                brownPixels++;
            }

            // Pale/washed out
            if (s < 0.2 && brightness > 150) {
                palePixels++;
            }
        }

        avgBrightness /= totalPixels;
        avgSaturation /= totalPixels;

        // Calculate percentages
        const yellowPercent = (yellowPixels / totalPixels) * 100;
        const greenPercent = (greenPixels / totalPixels) * 100;
        const darkGreenPercent = greenPixels > 0 ? (darkGreenPixels / greenPixels) * 100 : 0;
        const purplePercent = (purplePixels / totalPixels) * 100;
        const brownPercent = (brownPixels / totalPixels) * 100;
        const palePercent = (palePixels / totalPixels) * 100;

        return {
            yellowPercent,
            greenPercent,
            darkGreenPercent,
            purplePercent,
            brownPercent,
            palePercent,
            avgBrightness,
            avgSaturation,
            totalPixels
        };
    }

    function createVisualization(img, analysis) {
        const canvas = document.getElementById('analysisCanvas');
        const ctx = canvas.getContext('2d');

        canvas.width = img.width > 600 ? 600 : img.width;
        canvas.height = (img.height * canvas.width) / img.width;

        // Draw original image with transparency
        ctx.globalAlpha = 0.4;
        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
        ctx.globalAlpha = 1.0;

        // Add color overlays based on analysis
        ctx.font = 'bold 16px Arial';
        ctx.strokeStyle = 'white';
        ctx.lineWidth = 3;

        let y = 30;
        const highlights = [];

        if (analysis.yellowPercent > 15) {
            highlights.push({ color: '#f1c40f', label: 'Yellow zones detected', percent: analysis.yellowPercent });
        }
        if (analysis.purplePercent > 8) {
            highlights.push({ color: '#9b59b6', label: 'Purple/red zones', percent: analysis.purplePercent });
        }
        if (analysis.brownPercent > 10) {
            highlights.push({ color: '#795548', label: 'Brown edges', percent: analysis.brownPercent });
        }

        highlights.forEach(h => {
            ctx.fillStyle = h.color;
            ctx.strokeText(`${h.label}: ${h.percent.toFixed(1)}%`, 10, y);
            ctx.fillText(`${h.label}: ${h.percent.toFixed(1)}%`, 10, y);
            y += 30;
        });
    }

    function rgbToHue(r, g, b) {
        r /= 255; g /= 255; b /= 255;
        const max = Math.max(r, g, b);
        const min = Math.min(r, g, b);
        const delta = max - min;
        if (delta === 0) return 0;
        let hue;
        if (max === r) hue = ((g - b) / delta) % 6;
        else if (max === g) hue = (b - r) / delta + 2;
        else hue = (r - g) / delta + 4;
        hue = Math.round(hue * 60);
        if (hue < 0) hue += 360;
        return hue;
    }

    function rgbToSaturation(r, g, b) {
        r /= 255; g /= 255; b /= 255;
        const max = Math.max(r, g, b);
        const min = Math.min(r, g, b);
        if (max === 0) return 0;
        return (max - min) / max;
    }

    function displayResults(analysis) {
        const deficiencies = [];
        let overallHealth = 'excellent';
        let healthIcon = '‚úÖ';

        // Nitrogen deficiency
        if (analysis.yellowPercent > 12 || (analysis.greenPercent > 20 && analysis.darkGreenPercent < 35)) {
            const severity = analysis.yellowPercent > 25 ? 'severe' : analysis.yellowPercent > 18 ? 'moderate' : 'mild';
            const confidence = analysis.yellowPercent > 25 ? 'high' : analysis.yellowPercent > 18 ? 'medium' : 'low';
            
            deficiencies.push({
                name: 'Nitrogen Deficiency',
                icon: 'üü°',
                severity: severity,
                confidence: confidence,
                description: `Your plant shows signs of nitrogen deficiency with ${analysis.yellowPercent.toFixed(1)}% yellowing detected. Nitrogen is essential for leafy growth and overall plant vigor.`,
                symptoms: [
                    'Yellowing of older leaves, starting from the tips',
                    'Stunted growth and smaller leaves',
                    'Pale green to yellow color overall',
                    'Lower leaves affected first, then spreading upward'
                ],
                treatments: [
                    'Apply nitrogen-rich fertilizer (high first number in N-P-K ratio, like 10-5-5)',
                    'Use organic options: blood meal, fish emulsion, or composted manure',
                    'For quick results: water-soluble nitrogen fertilizer',
                    'Add fresh compost to improve soil nitrogen',
                    'Consider planting nitrogen-fixing cover crops nearby'
                ]
            });
            
            if (severity === 'severe') overallHealth = 'poor';
            else if (severity === 'moderate' && overallHealth === 'excellent') overallHealth = 'fair';
        }

        // Phosphorus deficiency
        if (analysis.purplePercent > 8) {
            const severity = analysis.purplePercent > 18 ? 'severe' : analysis.purplePercent > 12 ? 'moderate' : 'mild';
            const confidence = analysis.purplePercent > 18 ? 'high' : analysis.purplePercent > 12 ? 'medium' : 'low';
            
            deficiencies.push({
                name: 'Phosphorus Deficiency',
                icon: 'üü£',
                severity: severity,
                confidence: confidence,
                description: `Purple or reddish discoloration detected (${analysis.purplePercent.toFixed(1)}% of leaf area). Phosphorus is crucial for energy transfer, flowering, and root development.`,
                symptoms: [
                    'Purple, red, or dark blue discoloration on leaves',
                    'Most noticeable on older leaves and stems',
                    'Slow growth and delayed maturity',
                    'Reduced flowering and fruit production',
                    'Dark green leaves with purple undertones'
                ],
                treatments: [
                    'Apply bone meal or rock phosphate for slow-release phosphorus',
                    'Use fertilizer with high middle number (like 5-10-5)',
                    'Check and adjust soil pH to 6.0-7.0 for optimal phosphorus uptake',
                    'Add compost or aged manure to improve phosphorus availability',
                    'Consider fish bone meal for organic option'
                ]
            });
            
            if (severity === 'severe') overallHealth = 'poor';
            else if (severity === 'moderate' && overallHealth !== 'poor') overallHealth = 'fair';
        }

        // Potassium deficiency
        if (analysis.brownPercent > 10) {
            const severity = analysis.brownPercent > 20 ? 'severe' : analysis.brownPercent > 15 ? 'moderate' : 'mild';
            const confidence = analysis.brownPercent > 20 ? 'high' : analysis.brownPercent > 15 ? 'medium' : 'low';
            
            deficiencies.push({
                name: 'Potassium Deficiency',
                icon: 'üü§',
                severity: severity,
                confidence: confidence,
                description: `Brown, scorched leaf edges detected (${analysis.brownPercent.toFixed(1)}% of analyzed area). Potassium helps with water regulation, disease resistance, and overall plant strength.`,
                symptoms: [
                    'Brown, burned, or scorched leaf edges and tips',
                    'Yellowing between leaf veins (interveinal chlorosis)',
                    'Older leaves affected first',
                    'Weak stems and increased susceptibility to disease',
                    'Poor fruit quality and reduced crop yields'
                ],
                treatments: [
                    'Apply potassium sulfate or potassium chloride',
                    'Use wood ash (but monitor soil pH as it raises pH)',
                    'Choose fertilizer with high last number (like 5-5-10)',
                    'Organic options: kelp meal, greensand, or granite dust',
                    'Ensure adequate watering for potassium uptake'
                ]
            });
            
            if (severity === 'severe') overallHealth = 'poor';
            else if (severity === 'moderate' && overallHealth !== 'poor') overallHealth = 'fair';
        }

        // Iron deficiency
        if (analysis.palePercent > 18 && analysis.yellowPercent > 8 && analysis.greenPercent < 30) {
            deficiencies.push({
                name: 'Possible Iron Deficiency',
                icon: '‚ö™',
                severity: 'mild',
                confidence: 'low',
                description: 'Pale, washed-out coloring detected. This could indicate iron deficiency, especially if newer leaves are affected.',
                symptoms: [
                    'Yellowing between veins while veins stay green',
                    'Newer leaves affected more than older leaves',
                    'Overall pale or white appearance',
                    'Stunted growth'
                ],
                treatments: [
                    'Apply chelated iron or iron sulfate',
                    'Lower soil pH if too alkaline (iron unavailable above pH 7.0)',
                    'Improve drainage to prevent waterlogging',
                    'Use foliar iron spray for quick results'
                ]
            });
            
            if (overallHealth === 'excellent') overallHealth = 'good';
        }

        // Magnesium deficiency
        if (analysis.yellowPercent > 10 && analysis.greenPercent > 25 && analysis.darkGreenPercent > 40) {
            deficiencies.push({
                name: 'Possible Magnesium Deficiency',
                icon: 'üü®',
                severity: 'mild',
                confidence: 'low',
                description: 'Interveinal yellowing pattern suggests possible magnesium deficiency.',
                symptoms: [
                    'Yellowing between veins, veins remain green',
                    'Older leaves affected first',
                    'May progress to brown spots',
                    'Leaf curling at edges'
                ],
                treatments: [
                    'Apply Epsom salt (magnesium sulfate): 1 tablespoon per gallon',
                    'Use dolomitic lime for acidic soils',
                    'Add compost rich in magnesium',
                    'Foliar spray with Epsom salt solution'
                ]
            });
        }

        // Healthy plant
        if (deficiencies.length === 0) {
            overallHealth = 'excellent';
            deficiencies.push({
                name: 'Healthy Plant - No Deficiencies Detected',
                icon: '‚ú®',
                severity: 'healthy',
                confidence: 'high',
                description: `Congratulations! Your plant shows excellent color with ${analysis.greenPercent.toFixed(1)}% healthy green coloration. No major nutrient deficiencies detected.`,
                symptoms: [
                    'Vibrant, rich green color',
                    'Good color saturation',
                    'Minimal yellowing or discoloration',
                    'Healthy growth patterns'
                ],
                treatments: [
                    'Maintain current fertilization schedule',
                    'Continue regular watering routine',
                    'Monitor plant regularly for any changes',
                    'Consider light feeding every 4-6 weeks during growing season',
                    'Take a soil test if you want detailed nutrient analysis'
                ]
            });
        }

        // Build results HTML
        let html = '<div class="results-header"><h2>üåø Analysis Complete</h2></div>';

        // Overall health
        let healthClass = 'healthy';
        let healthLabel = 'Excellent';
        let healthEmoji = '‚ú®';
        
        if (overallHealth === 'poor') {
            healthClass = 'critical';
            healthLabel = 'Needs Attention';
            healthEmoji = '‚ö†Ô∏è';
        } else if (overallHealth === 'fair') {
            healthClass = 'warning';
            healthLabel = 'Fair';
            healthEmoji = 'üìä';
        } else if (overallHealth === 'good') {
            healthClass = 'healthy';
            healthLabel = 'Good';
            healthEmoji = 'üëç';
        }

        html += `
            <div class="overall-health ${healthClass}">
                <h3>${healthEmoji} Overall Plant Health: <span class="health-status ${overallHealth}">${healthLabel}</span></h3>
                <p style="margin-top: 10px; color: #555;">Based on color analysis of ${analysis.totalPixels.toLocaleString()} pixels</p>
            </div>
        `;

        // Statistics
        html += `
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value">${analysis.greenPercent.toFixed(0)}%</div>
                    <div class="stat-label">Healthy Green</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${analysis.yellowPercent.toFixed(0)}%</div>
                    <div class="stat-label">Yellow Zones</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${analysis.purplePercent.toFixed(0)}%</div>
                    <div class="stat-label">Purple/Red</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${analysis.brownPercent.toFixed(0)}%</div>
                    <div class="stat-label">Brown Edges</div>
                </div>
            </div>
        `;

        // Deficiency cards
        deficiencies.forEach(def => {
            html += `
                <div class="deficiency-card ${def.severity}">
                    <div class="deficiency-header">
                        <div class="deficiency-name">${def.icon} ${def.name}</div>
                        <div class="confidence-badge ${def.confidence}">${def.confidence} Confidence</div>
                    </div>
                    <div class="deficiency-description">${def.description}</div>
                    
                    <div class="symptoms-section">
                        <h4>üëÅÔ∏è Visual Symptoms:</h4>
                        <ul>
                            ${def.symptoms.map(s => `<li>${s}</li>`).join('')}
                        </ul>
                    </div>
                    
                    <div class="treatment-section">
                        <h4>üíä Recommended Treatments:</h4>
                        <ul>
                            ${def.treatments.map(t => `<li>${t}</li>`).join('')}
                        </ul>
                    </div>
                </div>
            `;
        });

        // Disclaimer
        html += `
            <div class="disclaimer">
                <h4>üìã Important Notes</h4>
                <p><strong>This is a preliminary screening tool.</strong> Color-based analysis can detect common deficiencies, but definitive diagnosis requires soil testing. Factors like lighting conditions, natural leaf color variations, and plant species can affect results. For critical growing situations or valuable plants, always consult with a professional horticulturist or conduct a proper soil test. Consider environmental factors like watering, pH, and sunlight exposure which can affect nutrient uptake.</p>
            </div>
        `;

        document.getElementById('results').innerHTML = html;
        document.getElementById('results').classList.add('active');
        
        // Scroll to results
        document.getElementById('results').scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
</script>
```

</body>
</html>
